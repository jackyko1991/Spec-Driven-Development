# 🌟 規格驅動開發 (SDD) 工作流程

[English](README.md)

本文件介紹**規格驅動開發 (Specification-Driven Development, SDD)** 工作流程，這是一種使用 Claude Code、AWS Kiro 和 Roo Code 等代理式開發工具來建構軟體的結構化方法。SDD 將開發過程劃分為四個明確階段：**指導架構師**、**規劃**、**執行**與**偵錯**。這種開發設計促進快速、高品質程式碼生成，並提升清晰度、可維護性與可追溯性。

---

## 目錄
- [🚀 SDD 工作流程概覽](#-sdd-工作流程概覽)
    - [1. 🧭 指導架構師模式](#1--指導架構師模式)
    - [2. 🗂️ 規劃模式](#2--️-規劃模式)
    - [3. ⚡ 執行模式](#3--執行模式)
    - [4. 🐞 偵錯模式](#4--偵錯模式)
- [🤖 設定 SDD 代理](#-設定-sdd-代理)
- [✅ SDD 最佳實踐](#-sdd-最佳實踐)
- [🔬 將 SDD 應用於科學數據分析](#-將-sdd-應用於科學數據分析)
- [結論](#結論)
- [參考資料](#參考資料)

---

## 🚀 SDD 工作流程概覽

SDD 工作流程包含三個主要階段，並設有專門的偵錯模式。

1.  **🧭 指導架構師模式 (Steering Architect Mode)**：定義專案的高階規則、產品願景、技術棧和整體結構。
2.  **🗂️ 規劃模式 (Planning Mode)**：協作創建詳細的功能規格，包括需求、設計文件和可執行的任務。
3.  **⚡ 執行模式 (Execution Mode)**：一個強大的、由測試驅動的引擎，它能實現任務，透過自我修復機制驗證正確性，並增量更新程式碼庫。
4.  **🐞 偵錯模式 (Debugger Mode)**：一個結構化的工作流程，用於識別、複製和修復錯誤，通常由執行模式啟動。

每個階段都由專門的代理工具和上下文文件支持，以在整個開發生命週期中強制執行編碼紀律並最大限度地減少模糊性。

```mermaid
graph LR
    A[🧭 指導架構師] --> B[🗂️ 規劃];
    B --> C[⚡ 執行];
    C -- 測試失敗 --> D[🐞 偵錯];
    D -- 修復已驗證 --> C;
```

---

## 1. 🧭 指導架構師模式

**職責：**
- 分析現有程式碼庫（如果有的話）以建立基準。
- 生成或更新基礎規則文件（例如，在 `.ai-rules/` 目錄中）。
- 記錄產品願景、技術棧、資料夾結構和專案級架構規則，包括單元測試與開發沙盒的設定。

**產出物：**
- `.ai-rules/product.md`：描述產品的用途、功能和目標受眾。
- `.ai-rules/tech.md`：指定要使用的程式語言、框架、函式庫和測試策略。
- `.ai-rules/structure.md`：定義專案的目錄佈局、文件組織和沙箱環境約定。

### 開發與偵錯沙盒

為確保乾淨且隔離的開發環境，指導架構師會建立統一沙盒的慣例。沙盒是一個暫時、隔離的空間，用於開發新功能或修復錯誤，不影響主程式碼庫。

為了確保一個乾淨且隔離的開發環境，指導架構師會建立使用統一沙盒的慣例。沙箱是一個暫時的、隔離的環境，用於開發新功能或修復錯誤，而不會影響主代碼庫。

所有隔離的工作，無論是新功能還是錯誤修復，都在 `.sandbox/` 目錄中進行。建立此沙盒的方法可以配置：
- **目錄複製**：僅複製任務所需的最少文件。
- **Git Worktree**：一種更進階的方法，沙箱是一個連結的 Git worktree，非常適合無縫版本控制和並行開發。

這些選擇會記錄在 `.ai-rules/structure.md` 中，且相應的資料夾會被添加到 `.gitignore` 以保持主儲存庫的整潔。

---

## 2. 🗂️ 規劃模式

**步驟：**
- **定義需求**：使用使用者故事、場景或 EARS (Event-Action-Response-State) 等方法來引出和記錄需求。
- **設計解決方案**：為模組、API 和互動序列創建高階設計。
- **分解任務**：將設計分解為小型、可管理的任務，並分析它們的依賴關係。

**規格資料夾結構：**
為每個功能創建一個專用資料夾來存放其規格：
```text
specs/
  └── feature-name/
      ├── requirements.md
      ├── design.md
      └── tasks.md
```

**協作精煉：**
與 AI 代理進行對話以精煉和澄清想法。代理應提出有針對性的問題（每個功能通常 3–5 個），從廣泛概念逐步細化至精確規格，確保最終規格文件全面且清晰。

---

## 3. ⚡ 執行模式

在執行模式下，代理會根據規劃階段定義的工作流程來實現任務，然後進行驗證。

-   **TDD 工作流程**：`task-executor` 編寫程式碼並交給 `tester`。`tester` 運行測試。如果測試失敗，它可以循環回到 `executor` 進行幾次嘗試。如果問題仍然存在，它會升級到 `debugger` 以獲得人機協作的支持。
-   **手動/UI 工作流程**：對於需要視覺確認的任務（如 UI/UX 變更），`task-executor` 會將變更直接發送到 `debugger` 進行人工審查和反饋。

### 詳細工作流程：
1.  **識別任務**：打開 `tasks.md` 並選擇第一個未勾選 (`[ ]`) 的任務。
2.  **理解任務**：閱讀任務描述，並參考相應的 `design.md` 和 `requirements.md` 以獲得完整上下文。
3.  **實現與記錄**：應用單一、原子的程式碼變更，僅處理當前任務。編碼時同步更新相關文件（如內聯註釋、使用者指南、API 文件）。
4.  **驗證**：遵循任務中定義的驗收標準或測試說明。
5.  **反思**：在「規則與提示」中記錄任何專案範圍內的學習或新建立的模式，以確保一致性。
6.  **更新狀態**：
    - 如果自動化測試通過，將任務標記為完成：`[x]`。
    - 如果驗證是手動的或沒有測試，則總結變更並要求使用者確認功能（除非在自主模式下運行）。確認後，將任務標記為 `[x]`。
    - 在開發日誌中總結所有變更，例如 `./dev-log/<yyyymmdd>.md`。
    - 主要任務完成後，如有需要，執行文件構建命令。

### 平行功能開發：
功能可平行開發，每個功能內的任務則按順序執行，有助於高效協作與快速交付。詳情請參閱 [Asynchronous Coding on Local with Git Worktree](https://gist.github.com/jackyko1991/deb71662444b021c28f38e22c40be53d)。

---

## 4. 🐞 偵錯模式 (Debugger Mode)

當在 **執行模式** 中發現錯誤時，SDD 工作流程提供了一個無縫過渡到 **偵錯模式** 的機制。此模式旨在為解決錯誤提供一個安全且結構化的環境，確保修復在合併到主程式碼庫之前在隔離環境中進行測試。

### 主要特點：
- **隔離**：錯誤在一個最小化的沙箱環境中（可以是已配置的沙箱或暫時的 `.ai_debug/` 資料夾）被複製，以防止對主要開發工作產生任何影響。
- **雙層策略**：提供 **原子函數測試**（使用 TDD）來處理獨立的錯誤，以及 **系統整合偵錯** 來處理更複雜的問題。
- **以使用者為中心的驗證**：代理與使用者合作，驗證修復是否解決了原始錯誤，且未引入新問題。
- **無縫工作流程整合**：在錯誤修復並合併後，代理會提示切換回 **執行模式** 以繼續下一個任務，確保開發週期的順暢。

### 執行-偵錯週期：一種鐘擺式方法

我們的 SDD 工作流程在 **執行** 和 **偵錯** 模式之間引入了一種「鐘擺」或「迴旋鏢」式的開發週期，專為在漸進模式下快速而穩定地開發功能而設計。

該週期運作如下：
1.  **執行**：`task-executor` 代理執行 `tasks.md` 文件中一個重要的、已規劃的任務。
2.  **驗證**：完成後，代理將變更呈現給使用者進行驗證。
3.  **偵錯（如果需要）**：如果使用者發現錯誤，工作流程將無縫過渡到 `debugger` 代理。然後在安全的沙箱環境中隔離、複製和修復該錯誤。
4.  **返回**：一旦錯誤解決且修復被合併，`debugger` 代理會提議切換回 `task-executor`。
5.  **繼續**：`task-executor` 接著執行下一個任務，保持開發的動力。

這個迭代過程確保了每一個實現的功能在繼續前都經過驗證，從而創建了一個緊密的反饋循環，能夠快速地建構出健壯可靠的功能。

---

## 🤖 設定 SDD 代理

本節提供有關配置 Claude Code 和 Roo Code 等代理工具以使用 SDD 方法論與子代理或模式的說明。

### 代理提示
每個模式的提示對於指導 AI 至關重要。
- [指導架構師模式提示](steering-architect-prompt.md)
- [規劃模式提示](planning-mode-prompt.md)
- [執行模式提示](execution-mode-prompt.md)
- [偵錯模式提示](debugger-prompt.md)

### Claude Code 設定
1.  在 Claude Code 中使用 `/agents` 命令並選擇 `Create new agent`。
2.  選擇 `Personal (~/.claude/agents/)` 以供全域使用，或選擇 `Project (.claude/agents)` 以供專案特定使用。
3.  選擇 `Manual configuration`。
4.  將代理類型（標識符）設置為 `steering-architect`、`planning-mode` 或 `execution-mode`。
5.  從上面的連結中複製相應的系統提示。
6.  從提示文件的標頭中複製子代理的描述。
7.  允許代理使用 `All tools`。
8.  為代理設置顏色或保留自動設置。
9.  保存新代理。
10. 使用類似以下的提示來使用代理：`Use @steering-architect to create project guidance for a Python library.`

### Roo Code 設定
1.  前往 `Modes` -> `Mode Settings` -> `Create New Mode`。
2.  提供模式名稱，例如 `🧭 Steering Architect`、`🗂️ Planning` 或 `⚡ Execution`。
3.  選擇 `Global` 作為保存位置，或選擇 `Project-specific` 以供本地使用。
4.  對於 `Role Definition`，從上面的連結中複製相應的提示。
5.  對於 `Short description (for humans)`，從提示文件的標頭中複製描述。
6.  對於 `When to Use`，從提示文件的標頭中複製 `when_to_use` 指南。保持 `Available Tools` 和 `Custom Instructions` 不變。
7.  保存新模式。
8.  切換到相應的模式，並使用類似以下的提示：`Create project guidance for a Python library project.`

---

## ✅ SDD 最佳實踐

1.  **保持關注點分離**：嚴格遵守每個階段的職責。
2.  **創建原子任務**：確保任務小型、獨立且可測試。
3.  **使用上下文文件**：始終參考規格文件進行每次變更，以保持一致性。
4.  **包含驗證步驟**：每個任務都應有明確的驗收標準。
5.  **迭代規格**：根據實施中的學習來精煉規格。
6.  **保持文件最新**：定期更新規則和文件以反映專案的演變。


---

## 🔬 將 SDD 應用於科學數據分析

有關將 SDD 方法論應用於科學數據分析和研究的詳細指南，請參閱此處的詳細指南：[將 SDD 應用於科學數據分析](scientific-application.md)

---

## 結論

本指南為結構化、可追溯且可維護的軟體開發提供強大框架。運用 SDD 方法論與代理工具，團隊能以更高速度、紀律與品質建構複雜系統。

## 參考資料
- [Kiro and the future of AI spec-driven software development](https://kiro.dev/blog/kiro-and-the-future-of-software-development/)
- [Claude Code Sub Agents](https://docs.anthropic.com/en/docs/claude-code/sub-agents)
- https://www.aivi.fyi/aiagents/introduce-Sub-agents